from google import genai
import config
import asyncio

client = genai.Client(api_key=config.GEMINI_API_KEY)

async def generate_disaster():
    prompt = (
        "–¢–∏ ‚Äî —Ü–∏–Ω—ñ—á–Ω–∏–π –≤–µ–¥—É—á–∏–π –Ω–∞—Å—Ç—ñ–ª—å–Ω–æ—ó –≥—Ä–∏ '–ë—É–Ω–∫–µ—Ä' (18+). –ó–≥–µ–Ω–µ—Ä—É–π —Å—Ü–µ–Ω–∞—Ä—ñ–π —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é. "
        "–°–£–í–û–†–Ü –û–ë–ú–ï–ñ–ï–ù–ù–Ø –ß–ò–°–ï–õ (–≥–µ–Ω–µ—Ä—É–π –≤–∏–ø–∞–¥–∫–æ–≤–æ): "
        "1. –ß–∞—Å –ø–µ—Ä–µ–±—É–≤–∞–Ω–Ω—è –≤ –±—É–Ω–∫–µ—Ä—ñ: –≤—ñ–¥ 6 –º—ñ—Å—è—Ü—ñ–≤ –¥–æ 7 —Ä–æ–∫—ñ–≤. "
        "2. –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ª—é–¥–µ–π, —â–æ –≤–∏–∂–∏–ª–∏ –Ω–∞ –ó–µ–º–ª—ñ: –≤—ñ–¥ 100 000 –¥–æ 100 –º—ñ–ª—å–π–æ–Ω—ñ–≤. "
        "–°–¢–†–£–ö–¢–£–†–ê –í–Ü–î–ü–û–í–Ü–î–Ü (—Å—É–≤–æ—Ä–æ –¥–æ 200 —Å–ª—ñ–≤): "
        "### üí• –ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞: [–ù–∞–∑–≤–∞] "
        "[–û–ø–∏—Å –ø—Ä–∏—á–∏–Ω–∏ —Ç–∞ –Ω–∞—Å–ª—ñ–¥–∫—ñ–≤. –î–æ–∑–≤–æ–ª–µ–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å–µ—Ä–π–æ–∑–Ω—ñ, –¥–æ—Ä–æ—Å–ª—ñ, –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—á–Ω–æ –Ω–∞–ø—Ä—É–∂–µ–Ω—ñ —Ç–µ–º–∏. –í–∫–∞–∂–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—Ü—ñ–ª—ñ–ª–∏—Ö]. "
        "### üõ°Ô∏è –ë—É–Ω–∫–µ—Ä: [–ù–∞–∑–≤–∞ —Ç–∞ –æ–ø–∏—Å –ª–æ–∫–∞—Ü—ñ—ó] "
        "* **–£–º–æ–≤–∏:** [–ü–ª–æ—â–∞, —â–æ —î (–∫–æ–º—Ñ–æ—Ä—Ç), —á–æ–≥–æ –Ω–µ–º–∞—î (–¥–µ—Ñ—ñ—Ü–∏—Ç)]. "
        "* **–†–µ—Å—É—Ä—Å–∏:** [–ù–∞ —Å–∫—ñ–ª—å–∫–∏ –≤–∏—Å—Ç–∞—á–∏—Ç—å —ó–∂—ñ, –≤–æ–¥–∏ —Ç–∞ –µ–Ω–µ—Ä–≥—ñ—ó]. "
        "* **–ß–∞—Å —ñ–∑–æ–ª—è—Ü—ñ—ó:** [–¢–≤—ñ–π –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π —Ç–µ—Ä–º—ñ–Ω]. "
        "**–ü–ª—é—Å–∏ —Ç–∞ –º—ñ–Ω—É—Å–∏:** "
        "‚úÖ **–ü–ª—é—Å–∏:** [–ü–µ—Ä–µ–≤–∞–≥–∞]. "
        "‚ùå **–ú—ñ–Ω—É—Å–∏:** [–ö—Ä–∏—Ç–∏—á–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞]."
    )

    try:
        response = await client.aio.models.generate_content(
            model='gemini-2.5-flash', 
            contents=prompt
        )
        return response.text
    except Exception as e:
        print(f"‚ùå –ü–û–ú–ò–õ–ö–ê AI (Disaster): {e}")
        return "‚ö†Ô∏è –°–≤—ñ—Ç –∑—Ä—É–π–Ω–æ–≤–∞–Ω–æ. –ó–≤'—è–∑–æ–∫ —ñ–∑ –®–Ü –≤—Ç—Ä–∞—á–µ–Ω–æ. –í–∏–∂–∏–≤–∞–π—Ç–µ —è–∫ –º–æ–∂–µ—Ç–µ."

async def analyze_survival(disaster, survivors_text):
    prompt = (
        f"–ì–†–ê '–ë–£–ù–ö–ï–†' –ó–ê–í–ï–†–®–ï–ù–ê. –ü–û–¢–†–Ü–ë–ï–ù –§–Ü–ù–ê–õ.\n\n"
        f"üåç –ö–ê–¢–ê–°–¢–†–û–§–ê: {disaster}\n\n"
        f"üë• –°–ü–ò–°–û–ö –¢–ò–•, –•–¢–û –í–ò–ñ–ò–í:\n{survivors_text}\n\n"
        f"–ó–ê–í–î–ê–ù–ù–Ø: \n"
        f"1. –ù–∞ –ø–æ—á–∞—Ç–∫—É –Ω–∞–ø–∏—à–∏ –∂–∏—Ä–Ω–∏–º: **–®–∞–Ω—Å –Ω–∞ –≤–∏–∂–∏–≤–∞–Ω–Ω—è –ª—é–¥—Å—Ç–≤–∞: [–≤—ñ–¥—Å–æ—Ç–æ–∫ –≤—ñ–¥ 0% –¥–æ 100%]**\n"
        f"2. –î–∞–ª—ñ –Ω–∞–ø–∏—à–∏ —Å–∞—Ä–∫–∞—Å—Ç–∏—á–Ω–∏–π, –∞–ª–µ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–∏–π –≤–∏—Å–Ω–æ–≤–æ–∫ (–¥–æ 100 —Å–ª—ñ–≤). "
        f"–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π, —á–∏ –∑–º–æ–∂—É—Ç—å —Ü—ñ –ª—é–¥–∏ –≤—ñ–¥—Ä–æ–¥–∏—Ç–∏ –ø–æ–ø—É–ª—è—Ü—ñ—é, –≤—Ä–∞—Ö–æ–≤—É—é—á–∏ —ó—Ö–Ω—ñ –ø—Ä–æ—Ñ–µ—Å—ñ—ó, –≤—ñ–∫, –∑–¥–æ—Ä–æ–≤'—è (–æ—Å–æ–±–ª–∏–≤–æ –±–µ–∑–ø–ª—ñ–¥–¥—è) —Ç–∞ —Ñ–æ–±—ñ—ó. "
        f"–Ø–∫—â–æ –≥—Ä—É–ø–∞ —Å–ª–∞–±–∫–∞ ‚Äî –æ–ø–∏—à–∏, —è–∫ —Å–∞–º–µ –≤–æ–Ω–∏ –∑–∞–≥–∏–Ω—É—Ç—å. –Ø–∫—â–æ —Å–∏–ª—å–Ω–∞ ‚Äî –æ–ø–∏—à–∏ —ó—Ö–Ω—î –º–∞–π–±—É—Ç–Ω—î. –ü–∏—à–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é."
    )
    
    try:
        response = await client.aio.models.generate_content(
            model='gemini-2.5-flash', 
            contents=prompt
        )
        return response.text
    except Exception as e:
        print(f"‚ùå –ü–û–ú–ò–õ–ö–ê AI (Analyze): {e}")
        return f"–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Ñ—ñ–Ω–∞–ª. –ü–æ–º–∏–ª–∫–∞: {e}"
